<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Hosting Jupyter at a subdomain via Cloudflare | anthony lukach</title><meta name=keywords content="jupyter,machine-learning,cloudflare,devops"><meta name=description content="Full Disclosure: I am NOT an expert at Jupyter or Anaconda (which I am using in this project), there may be some bad habits below&mldr;
Below is a quick scratchpad of the steps I took to serve Jupyter from a subdomain. Jupyter is running behind NGINX on an OpenStack Ubuntu instance and the domain&rsquo;s DNS is set up to use Cloudflare to provides convenient SSL support. I was suprised by the lack of documentation for this process, prompting me to document my steps taken here."><meta name=author content><link rel=canonical href=https://alukach.com/posts/serving-jupyter/><link crossorigin=anonymous href=/assets/css/stylesheet.min.4ba82eb0954ce20ea51d7ca6c3b71ea48dd719c880f27386be309802fedc6b21.css integrity="sha256-S6gusJVM4g6lHXymw7cepI3XGciA8nOGvjCYAv7cayE=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.min.e85ad0406048e8176e1c7661b25d5c69297ddfe41dc4124cf75ecb99a4f7b3d1.js integrity="sha256-6FrQQGBI6BduHHZhsl1caSl93+QdxBJM917LmaT3s9E=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://alukach.com/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://alukach.com/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://alukach.com/favicon-32x32.png><link rel=apple-touch-icon href=https://alukach.com/apple-touch-icon.png><link rel=mask-icon href=https://alukach.com/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script type=application/javascript>var doNotTrack=!1;doNotTrack||(function(e,t,n,s,o,i,a){e.GoogleAnalyticsObject=o,e[o]=e[o]||function(){(e[o].q=e[o].q||[]).push(arguments)},e[o].l=1*new Date,i=t.createElement(n),a=t.getElementsByTagName(n)[0],i.async=1,i.src=s,a.parentNode.insertBefore(i,a)}(window,document,"script","https://www.google-analytics.com/analytics.js","ga"),ga("create","UA-16401510-1","auto"),ga("send","pageview"))</script><meta property="og:title" content="Hosting Jupyter at a subdomain via Cloudflare"><meta property="og:description" content="Full Disclosure: I am NOT an expert at Jupyter or Anaconda (which I am using in this project), there may be some bad habits below&mldr;
Below is a quick scratchpad of the steps I took to serve Jupyter from a subdomain. Jupyter is running behind NGINX on an OpenStack Ubuntu instance and the domain&rsquo;s DNS is set up to use Cloudflare to provides convenient SSL support. I was suprised by the lack of documentation for this process, prompting me to document my steps taken here."><meta property="og:type" content="article"><meta property="og:url" content="https://alukach.com/posts/serving-jupyter/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2016-12-28T00:00:00+00:00"><meta property="article:modified_time" content="2016-12-28T00:00:00+00:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Hosting Jupyter at a subdomain via Cloudflare"><meta name=twitter:description content="Full Disclosure: I am NOT an expert at Jupyter or Anaconda (which I am using in this project), there may be some bad habits below&mldr;
Below is a quick scratchpad of the steps I took to serve Jupyter from a subdomain. Jupyter is running behind NGINX on an OpenStack Ubuntu instance and the domain&rsquo;s DNS is set up to use Cloudflare to provides convenient SSL support. I was suprised by the lack of documentation for this process, prompting me to document my steps taken here."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://alukach.com/posts/"},{"@type":"ListItem","position":2,"name":"Hosting Jupyter at a subdomain via Cloudflare","item":"https://alukach.com/posts/serving-jupyter/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Hosting Jupyter at a subdomain via Cloudflare","name":"Hosting Jupyter at a subdomain via Cloudflare","description":"Full Disclosure: I am NOT an expert at Jupyter or Anaconda (which I am using in this project), there may be some bad habits below\u0026hellip;\nBelow is a quick scratchpad of the steps I took to serve Jupyter from a subdomain. Jupyter is running behind NGINX on an OpenStack Ubuntu instance and the domain\u0026rsquo;s DNS is set up to use Cloudflare to provides convenient SSL support. I was suprised by the lack of documentation for this process, prompting me to document my steps taken here.","keywords":["jupyter","machine-learning","cloudflare","devops"],"articleBody":"Full Disclosure: I am NOT an expert at Jupyter or Anaconda (which I am using in this project), there may be some bad habits below…\nBelow is a quick scratchpad of the steps I took to serve Jupyter from a subdomain. Jupyter is running behind NGINX on an OpenStack Ubuntu instance and the domain’s DNS is set up to use Cloudflare to provides convenient SSL support. I was suprised by the lack of documentation for this process, prompting me to document my steps taken here.\nCloudflare Set up Cloudflare account, utilizing its provided Name Servers with my domain registration. Set up Cloudflare DNS Record for subdomain (ex jupyter to server from jupyter.mydomain.com). In the image below, the DNS entry for the Jupyter server was “greyed-out”, relegating it to “DNS Only” rather than “DNS and HTTP Proxy (CDN)”.. Now that Cloudflare supports websockets, this is no longer necessary and you’re able to take advantage of using Cloudflare as a CDN (admittedly, I’m not sure how useful this actually is, but it’s worth mentioning). Ensure Crypto settings are set correctly. You should probably be using Full SSL (Strict) rather than Flexible SSL as shown in the image below, however that is outside the scope of this post. Install Anaconda Follow instructions described here.\nSet up an Upstart script On the server, you’ll want Jupyter to start running as soon as the server starts. We’ll use an Upstart script to acheive this.\n# /etc/init/ipython-notebook.conf start on filesystem or runlevel [2345] stop on shutdown # Restart the process if it dies with a signal # or exit code not given by the 'normal exit' stanza. respawn # Give up if restart occurs 10 times in 90 seconds. respawn limit 10 90 description \"Jupyter / IPython Notebook Upstart script\" setuid \"MY_USER\" setgid \"MY_USER\" chdir \"/home/MY_USER/notebooks\" script exec /home/MY_USER/.anaconda3/bin/jupyter notebook --config='/home/MY_USER/.jupyter/jupyter_notebook_config.py' end script Configure Jupyter Populate Jupyter with required configuration. You should probably auto-generate the configuration first and then just change the applicable variables.\n1 2 3 4 5 6 7 8 9 10 11 12 # .jupyter/jupyter_notebook_config.py c.NotebookApp.allow_origin = 'https://jupyter.mydomain.com' c.NotebookApp.notebook_dir = '/home/MY_USER/notebooks' c.NotebookApp.open_browser = False c.NotebookApp.password = 'some_password_hash' c.NotebookApp.port = 8888 c.NotebookApp.kernel_spec_manager_class = \"nb_conda_kernels.CondaKernelSpecManager\" c.NotebookApp.nbserver_extensions = { \"nb_conda\": True, \"nb_anacondacloud\": True, \"nbpresent\": True } Wire Jupyter up with Nginx To be able to access Jupyter at port 80, we’ll need to reverse proxy to the service. Nginx can take care of this for us. Jupyter uses websockets to stream data to the client, so some\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 # /etc/nginx/sites-enabled/jupyter.conf # Based on example: https://gist.github.com/cboettig/8643341bd3c93b62b5c2 upstream jupyter { server 127.0.0.1:8888 fail_timeout=0; } map $http_upgrade $connection_upgrade { default upgrade; '' close; } server { listen 80 default_server; listen [::]:80 default_server ipv6only=on; # Make site accessible from http://localhost/ server_name localhost; client_max_body_size 50M; location / { proxy_pass http://jupyter; proxy_set_header X-Real-IP $remote_addr; proxy_set_header Host $host; proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; } location ~* /(api/kernels/[^/]+/(channels|iopub|shell|stdin)|terminals/websocket)/? { proxy_pass http://jupyter; proxy_set_header X-Real-IP $remote_addr; proxy_set_header Host $host; proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; # WebSocket support proxy_http_version 1.1; proxy_set_header Upgrade $http_upgrade; proxy_set_header Connection $connection_upgrade; } } ","wordCount":"535","inLanguage":"en","datePublished":"2016-12-28T00:00:00Z","dateModified":"2016-12-28T00:00:00Z","mainEntityOfPage":{"@type":"WebPage","@id":"https://alukach.com/posts/serving-jupyter/"},"publisher":{"@type":"Organization","name":"anthony lukach","logo":{"@type":"ImageObject","url":"https://alukach.com/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://alukach.com/ accesskey=h title="anthony lukach (Alt + H)">anthony lukach</a>
<span class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></span></div><ul id=menu><li><a href=https://alukach.com/categories/posts title=Posts><span>Posts</span></a></li><li><a href=https://alukach.com/categories/snippets title=Snippets><span>Snippets</span></a></li><li><a href=https://alukach.com/search title="Search (Alt + /)" accesskey=/><span>Search</span></a></li><li><a href=https://alukach.com/resume title=Résumé><span>Résumé</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class=post-title>Hosting Jupyter at a subdomain via Cloudflare</h1><div class=post-meta><span title='2016-12-28 00:00:00 +0000 UTC'>December 28, 2016</span>&nbsp;·&nbsp;3 min&nbsp;|&nbsp;<a href=https://github.com/alukach/alukach.github.io/edit/main/content/posts/serving-jupyter.md rel="noopener noreferrer" target=_blank>Suggest Changes</a></div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#cloudflare aria-label=Cloudflare>Cloudflare</a></li><li><a href=#install-anaconda aria-label="Install Anaconda">Install Anaconda</a></li><li><a href=#set-up-an-upstart-script aria-label="Set up an Upstart script">Set up an Upstart script</a></li><li><a href=#configure-jupyter aria-label="Configure Jupyter">Configure Jupyter</a></li><li><a href=#wire-jupyter-up-with-nginx aria-label="Wire Jupyter up with Nginx">Wire Jupyter up with Nginx</a></li></ul></div></details></div><div class=post-content><p><em>Full Disclosure: I am NOT an expert at Jupyter or Anaconda (which I am using in this project), there may be some bad habits below&mldr;</em></p><p>Below is a quick scratchpad of the steps I took to serve Jupyter from a subdomain. Jupyter is running behind NGINX on an OpenStack Ubuntu instance and the domain&rsquo;s DNS is set up to use Cloudflare to provides convenient SSL support. I was suprised by the lack of documentation for this process, prompting me to document my steps taken here.</p><h2 id=cloudflare>Cloudflare<a hidden class=anchor aria-hidden=true href=#cloudflare>#</a></h2><ol><li>Set up Cloudflare account, utilizing its provided Name Servers with my domain registration.</li><li>Set up Cloudflare DNS Record for subdomain (ex <code>jupyter</code> to server from <code>jupyter.mydomain.com</code>). In the image below, the DNS entry for the Jupyter server was &ldquo;greyed-out&rdquo;, relegating it to &ldquo;DNS Only&rdquo; rather than &ldquo;DNS and HTTP Proxy (CDN)&rdquo;.. Now that <a href=https://support.cloudflare.com/hc/en-us/articles/200169466-Can-I-use-CloudFlare-with-WebSockets->Cloudflare supports websockets</a>, this is no longer necessary and you&rsquo;re able to take advantage of using Cloudflare as a CDN (admittedly, I&rsquo;m not sure how useful this actually is, but it&rsquo;s worth mentioning).
<img loading=lazy src=/images/2016-12-28-jupyter/manage_dns.png alt="Setting up DNS Record"></li><li>Ensure Crypto settings are set correctly. You should probably be using <a href=https://blog.cloudflare.com/introducing-strict-ssl-protecting-against-a-man-in-the-middle-attack-on-origin-traffic/>Full SSL (Strict)</a> rather than Flexible SSL as shown in the image below, however that is outside the scope of this post.
<img loading=lazy src=/images/2016-12-28-jupyter/ssl_settings.png alt="SSL Settings">
<img loading=lazy src=/images/2016-12-28-jupyter/https_rewrite.png alt="Auto-rewrite to HTTPS"></li></ol><h2 id=install-anaconda>Install Anaconda<a hidden class=anchor aria-hidden=true href=#install-anaconda>#</a></h2><p>Follow instructions described <a href=https://docs.continuum.io/anaconda/install#linux-install>here</a>.</p><h2 id=set-up-an-upstart-script>Set up an Upstart script<a hidden class=anchor aria-hidden=true href=#set-up-an-upstart-script>#</a></h2><p>On the server, you&rsquo;ll want Jupyter to start running as soon as the server starts. We&rsquo;ll use an Upstart script to acheive this.</p><pre tabindex=0><code class=language-upstart data-lang=upstart># /etc/init/ipython-notebook.conf
start on filesystem or runlevel [2345]
stop on shutdown

# Restart the process if it dies with a signal
# or exit code not given by the &#39;normal exit&#39; stanza.
respawn

# Give up if restart occurs 10 times in 90 seconds.
respawn limit 10 90

description &#34;Jupyter / IPython Notebook Upstart script&#34;
setuid &#34;MY_USER&#34;
setgid &#34;MY_USER&#34;
chdir &#34;/home/MY_USER/notebooks&#34;

script
    exec /home/MY_USER/.anaconda3/bin/jupyter notebook --config=&#39;/home/MY_USER/.jupyter/jupyter_notebook_config.py&#39;
end script
</code></pre><h2 id=configure-jupyter>Configure Jupyter<a hidden class=anchor aria-hidden=true href=#configure-jupyter>#</a></h2><p>Populate Jupyter with required configuration. You should probably auto-generate the configuration first and then just change the applicable variables.</p><div class=highlight><div style=color:#4d4d4d;background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#4d4d4d;background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#4d4d4d;background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#0080ff;font-style:italic># .jupyter/jupyter_notebook_config.py</span>
</span></span><span style=display:flex><span>c<span style=color:#2c5dcd>.</span>NotebookApp<span style=color:#2c5dcd>.</span>allow_origin <span style=color:#2c5dcd>=</span> <span style=color:#0c6>&#39;https://jupyter.mydomain.com&#39;</span>
</span></span><span style=display:flex><span>c<span style=color:#2c5dcd>.</span>NotebookApp<span style=color:#2c5dcd>.</span>notebook_dir <span style=color:#2c5dcd>=</span> <span style=color:#0c6>&#39;/home/MY_USER/notebooks&#39;</span>
</span></span><span style=display:flex><span>c<span style=color:#2c5dcd>.</span>NotebookApp<span style=color:#2c5dcd>.</span>open_browser <span style=color:#2c5dcd>=</span> <span style=color:#2c5dcd;font-weight:700>False</span>
</span></span><span style=display:flex><span>c<span style=color:#2c5dcd>.</span>NotebookApp<span style=color:#2c5dcd>.</span>password <span style=color:#2c5dcd>=</span> <span style=color:#0c6>&#39;some_password_hash&#39;</span>
</span></span><span style=display:flex><span>c<span style=color:#2c5dcd>.</span>NotebookApp<span style=color:#2c5dcd>.</span>port <span style=color:#2c5dcd>=</span> <span style=color:#5918bb;font-weight:700>8888</span>
</span></span><span style=display:flex><span>c<span style=color:#2c5dcd>.</span>NotebookApp<span style=color:#2c5dcd>.</span>kernel_spec_manager_class <span style=color:#2c5dcd>=</span> <span style=color:#0c6>&#34;nb_conda_kernels.CondaKernelSpecManager&#34;</span>
</span></span><span style=display:flex><span>c<span style=color:#2c5dcd>.</span>NotebookApp<span style=color:#2c5dcd>.</span>nbserver_extensions <span style=color:#2c5dcd>=</span> {
</span></span><span style=display:flex><span>  <span style=color:#0c6>&#34;nb_conda&#34;</span>: <span style=color:#2c5dcd;font-weight:700>True</span>,
</span></span><span style=display:flex><span>  <span style=color:#0c6>&#34;nb_anacondacloud&#34;</span>: <span style=color:#2c5dcd;font-weight:700>True</span>,
</span></span><span style=display:flex><span>  <span style=color:#0c6>&#34;nbpresent&#34;</span>: <span style=color:#2c5dcd;font-weight:700>True</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></td></tr></table></div></div><h2 id=wire-jupyter-up-with-nginx>Wire Jupyter up with Nginx<a hidden class=anchor aria-hidden=true href=#wire-jupyter-up-with-nginx>#</a></h2><p>To be able to access Jupyter at port 80, we&rsquo;ll need to reverse proxy to the service. Nginx can take care of this for us. Jupyter uses websockets to stream data to the client, so some</p><div class=highlight><div style=color:#4d4d4d;background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#4d4d4d;background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">25
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">26
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">27
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">28
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">29
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">30
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">31
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">32
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">33
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">34
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">35
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">36
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">37
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">38
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">39
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#4d4d4d;background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-nginx data-lang=nginx><span style=display:flex><span><span style=color:#0080ff;font-style:italic># /etc/nginx/sites-enabled/jupyter.conf
</span></span></span><span style=display:flex><span><span style=color:#0080ff;font-style:italic># Based on example: https://gist.github.com/cboettig/8643341bd3c93b62b5c2
</span></span></span><span style=display:flex><span><span style=color:#0080ff;font-style:italic></span><span style=color:#2c5dcd;font-weight:700>upstream</span> <span style=color:#0c6>jupyter</span> {
</span></span><span style=display:flex><span>    <span style=color:#2c5dcd;font-weight:700>server</span> 127.0.0.1:<span style=color:#5918bb;font-weight:700>8888</span> <span style=color:#0c6>fail_timeout=0</span>;
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span> <span style=color:#2c5dcd;font-weight:700>map</span> $http_upgrade $connection_upgrade {
</span></span><span style=display:flex><span>     <span style=color:#2c5dcd;font-weight:700>default</span> <span style=color:#0c6>upgrade</span>;
</span></span><span style=display:flex><span>     <span style=color:#2c5dcd;font-weight:700>&#39;&#39;</span> <span style=color:#0c6>close</span>;
</span></span><span style=display:flex><span> }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#2c5dcd;font-weight:700>server</span> {
</span></span><span style=display:flex><span>    <span style=color:#2c5dcd;font-weight:700>listen</span> <span style=color:#5918bb;font-weight:700>80</span> <span style=color:#0c6>default_server</span>;
</span></span><span style=display:flex><span>    <span style=color:#2c5dcd;font-weight:700>listen</span> <span style=color:#0c6>[::]:80</span> <span style=color:#0c6>default_server</span> <span style=color:#0c6>ipv6only=on</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#0080ff;font-style:italic># Make site accessible from http://localhost/
</span></span></span><span style=display:flex><span><span style=color:#0080ff;font-style:italic></span>    <span style=color:#2c5dcd;font-weight:700>server_name</span> <span style=color:#0c6>localhost</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#2c5dcd;font-weight:700>client_max_body_size</span> <span style=color:#0c6>50M</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#2c5dcd;font-weight:700>location</span> <span style=color:#0c6>/</span> {
</span></span><span style=display:flex><span>        <span style=color:#2c5dcd;font-weight:700>proxy_pass</span> <span style=color:#0c6>http://jupyter</span>;
</span></span><span style=display:flex><span>        <span style=color:#2c5dcd;font-weight:700>proxy_set_header</span> <span style=color:#0c6>X-Real-IP</span> $remote_addr;
</span></span><span style=display:flex><span>        <span style=color:#2c5dcd;font-weight:700>proxy_set_header</span> <span style=color:#0c6>Host</span> $host;
</span></span><span style=display:flex><span>        <span style=color:#2c5dcd;font-weight:700>proxy_set_header</span> <span style=color:#0c6>X-Forwarded-For</span> $proxy_add_x_forwarded_for;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#2c5dcd;font-weight:700>location</span> ~<span style=color:#0c6>*</span> <span style=color:#0c6>/(api/kernels/[^/]+/(channels|iopub|shell|stdin)|terminals/websocket)/?</span> {
</span></span><span style=display:flex><span>        <span style=color:#2c5dcd;font-weight:700>proxy_pass</span> <span style=color:#0c6>http://jupyter</span>;
</span></span><span style=display:flex><span>        <span style=color:#2c5dcd;font-weight:700>proxy_set_header</span> <span style=color:#0c6>X-Real-IP</span> $remote_addr;
</span></span><span style=display:flex><span>        <span style=color:#2c5dcd;font-weight:700>proxy_set_header</span> <span style=color:#0c6>Host</span> $host;
</span></span><span style=display:flex><span>        <span style=color:#2c5dcd;font-weight:700>proxy_set_header</span> <span style=color:#0c6>X-Forwarded-For</span> $proxy_add_x_forwarded_for;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#0080ff;font-style:italic># WebSocket support
</span></span></span><span style=display:flex><span><span style=color:#0080ff;font-style:italic></span>        <span style=color:#2c5dcd;font-weight:700>proxy_http_version</span> <span style=color:#5918bb;font-weight:700>1</span><span style=color:#0c6>.1</span>;
</span></span><span style=display:flex><span>        <span style=color:#2c5dcd;font-weight:700>proxy_set_header</span> <span style=color:#0c6>Upgrade</span> $http_upgrade;
</span></span><span style=display:flex><span>        <span style=color:#2c5dcd;font-weight:700>proxy_set_header</span> <span style=color:#0c6>Connection</span> $connection_upgrade;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></td></tr></table></div></div></div><footer class=post-footer><ul class=post-tags><li><a href=https://alukach.com/tags/jupyter/>jupyter</a></li><li><a href=https://alukach.com/tags/machine-learning/>machine-learning</a></li><li><a href=https://alukach.com/tags/cloudflare/>cloudflare</a></li><li><a href=https://alukach.com/tags/devops/>devops</a></li></ul></footer></article></main><footer class=footer><span>&copy; 2022 <a href=https://alukach.com/>anthony lukach</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://git.io/hugopapermod rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerText="copy";function s(){t.innerText="copied!",setTimeout(()=>{t.innerText="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>