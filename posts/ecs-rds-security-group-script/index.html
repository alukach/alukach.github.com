<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>An ECS -> RDS Security Group Script | anthony lukach</title>
<meta name=keywords content="ecs,rds,aws"><meta name=description content="Below is a simple script to allow a user to alter RDS databases security groups to allow access from an ECS Service. Useful when we have an observability tool runing in ECS that wants to add RDS data connections.
1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 from typing import List, Dict import boto3 from botocore."><meta name=author content><link rel=canonical href=https://alukach.com/posts/ecs-rds-security-group-script/><link crossorigin=anonymous href=/assets/css/stylesheet.min.4ba82eb0954ce20ea51d7ca6c3b71ea48dd719c880f27386be309802fedc6b21.css integrity="sha256-S6gusJVM4g6lHXymw7cepI3XGciA8nOGvjCYAv7cayE=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.min.2eadbb982468c11a433a3e291f01326f2ba43f065e256bf792dbd79640a92316.js integrity="sha256-Lq27mCRowRpDOj4pHwEybyukPwZeJWv3ktvXlkCpIxY=" onload=hljs.initHighlightingOnLoad()></script><link rel=icon href=https://alukach.com/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://alukach.com/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://alukach.com/favicon-32x32.png><link rel=apple-touch-icon href=https://alukach.com/apple-touch-icon.png><link rel=mask-icon href=https://alukach.com/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://alukach.com/posts/ecs-rds-security-group-script/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:title" content="An ECS -> RDS Security Group Script"><meta property="og:description" content="Below is a simple script to allow a user to alter RDS databases security groups to allow access from an ECS Service. Useful when we have an observability tool runing in ECS that wants to add RDS data connections.
1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 from typing import List, Dict import boto3 from botocore."><meta property="og:type" content="article"><meta property="og:url" content="https://alukach.com/posts/ecs-rds-security-group-script/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2024-02-08T00:00:00+00:00"><meta property="article:modified_time" content="2024-02-08T00:00:00+00:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="An ECS -> RDS Security Group Script"><meta name=twitter:description content="Below is a simple script to allow a user to alter RDS databases security groups to allow access from an ECS Service. Useful when we have an observability tool runing in ECS that wants to add RDS data connections.
1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 from typing import List, Dict import boto3 from botocore."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://alukach.com/posts/"},{"@type":"ListItem","position":2,"name":"An ECS -\u003e RDS Security Group Script","item":"https://alukach.com/posts/ecs-rds-security-group-script/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"An ECS -\u003e RDS Security Group Script","name":"An ECS -\u003e RDS Security Group Script","description":"Below is a simple script to allow a user to alter RDS databases security groups to allow access from an ECS Service. Useful when we have an observability tool runing in ECS that wants to add RDS data connections.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 from typing import List, Dict import boto3 from botocore.","keywords":["ecs","rds","aws"],"articleBody":"Below is a simple script to allow a user to alter RDS databases security groups to allow access from an ECS Service. Useful when we have an observability tool runing in ECS that wants to add RDS data connections.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 from typing import List, Dict import boto3 from botocore.exceptions import ClientError import inquirer def list_ecs_clusters(): ecs = boto3.client(\"ecs\") clusters = ecs.list_clusters() cluster_arns = clusters[\"clusterArns\"] return cluster_arns def list_ecs_services(cluster) -\u003e List[str]: ecs = boto3.client(\"ecs\") services = ecs.list_services(cluster=cluster) return services[\"serviceArns\"] def list_rds_instances() -\u003e Dict[str, str]: rds = boto3.client(\"rds\") return rds.describe_db_instances()[\"DBInstances\"] def get_security_group_from_ecs_service(cluster, service_arn) -\u003e str: ecs = boto3.client(\"ecs\") details = ecs.describe_services(cluster=cluster, services=[service_arn]) service = details[\"services\"][0] deployment = service[\"deployments\"][0] groups = deployment[\"networkConfiguration\"][\"awsvpcConfiguration\"][\"securityGroups\"] return groups[0] def get_security_group_ids_for_rds_instance(instance_identifier) -\u003e List[str]: \"\"\" Returns the security group IDs for a given RDS instance identifier. :param instance_identifier: The identifier of the RDS instance :return: A list of security group IDs associated with the RDS instance \"\"\" rds = boto3.client(\"rds\") try: response = rds.describe_db_instances(DBInstanceIdentifier=instance_identifier) db_instances = response[\"DBInstances\"] if db_instances: # Assuming each instance has at least one security group associated with it security_groups = db_instances[0][\"VpcSecurityGroups\"] security_group_ids = [sg[\"VpcSecurityGroupId\"] for sg in security_groups] return security_group_ids else: return [] except Exception as e: print( f\"Error fetching security group IDs for RDS instance '{instance_identifier}': {e}\" ) return [] def modify_security_group_rules( security_group_id, protocol, from_port, to_port, source_security_group_id: str, description: str, dry_run: bool, ) -\u003e None: ec2 = boto3.client(\"ec2\") if dry_run: print( f\"Dry run: Would update Security Group {security_group_id} \" f\"to allow from {source_security_group_id}\" ) return try: ec2.authorize_security_group_ingress( GroupId=security_group_id, IpPermissions=[ { \"IpProtocol\": protocol, \"FromPort\": from_port, \"ToPort\": to_port, \"UserIdGroupPairs\": [ { \"GroupId\": source_security_group_id, \"Description\": description, } ], } ], ) print(f\"Security Group {security_group_id} updated successfully.\") except ClientError as e: print(f\"Error updating Security Group: {e}\") if __name__ == \"__main__\": dry_run = inquirer.confirm( message=\"Dry run (no changes will be made)?\", default=True, ) ecs_clusters = list_ecs_clusters() rds_instances = list_rds_instances() # Select ECS Cluster resource_questions = [ inquirer.List( \"cluster\", message=\"Select ECS Cluster that contains the service that requires databases access\", choices=ecs_clusters, default=lambda answers: next( (cluster for cluster in ecs_clusters if \"grafana\" in cluster), None ), ), inquirer.List( \"service\", message=\"Select ECS Service in {cluster} that requires database access\", choices=lambda answers: list_ecs_services(answers[\"cluster\"]), ), inquirer.Checkbox( \"rds_instances\", message=\"Select RDS Instances that will be accessed via {cluster}/{service}\", choices=[instance[\"DBInstanceIdentifier\"] for instance in rds_instances], ), inquirer.Text( \"description\", message=\"Provide a description for the connection\", default=lambda answers: f\"Allow connections from ECS service: {answers['service'].split(':')[-1]}\", ), ] resources = inquirer.prompt(resource_questions) # Get Security Group of selected RDS Instances rds_security_groups = [ get_security_group_ids_for_rds_instance(rds_instance)[0] for rds_instance in resources[\"rds_instances\"] ] # Get Security Group of selected ECS Service ecs_security_group = get_security_group_from_ecs_service( resources[\"cluster\"], resources[\"service\"] ) # Update RDS Instances' Security Groups to allow inbound connections from ECS Service print(f\"{rds_security_groups=}\") for rds_sg_id in rds_security_groups: modify_security_group_rules( security_group_id=rds_sg_id, source_security_group_id=ecs_security_group, protocol=\"tcp\", to_port=5432, from_port=5432, description=resources[\"description\"], dry_run=dry_run, ) ","wordCount":"605","inLanguage":"en","datePublished":"2024-02-08T00:00:00Z","dateModified":"2024-02-08T00:00:00Z","mainEntityOfPage":{"@type":"WebPage","@id":"https://alukach.com/posts/ecs-rds-security-group-script/"},"publisher":{"@type":"Organization","name":"anthony lukach","logo":{"@type":"ImageObject","url":"https://alukach.com/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://alukach.com/ accesskey=h title="anthony lukach (Alt + H)">anthony lukach</a>
<span class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button><ul class=lang-switch><li>|</li></ul></span></div><ul id=menu><li><a href=https://alukach.com/categories/posts title=Posts><span>Posts</span></a></li><li><a href=https://alukach.com/categories/snippets title=Snippets><span>Snippets</span></a></li><li><a href=https://alukach.com/search title="Search (Alt + /)" accesskey=/><span>Search</span></a></li><li><a href=https://alukach.com/resume title=Résumé><span>Résumé</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class=post-title>An ECS -> RDS Security Group Script</h1><div class=post-meta>&lt;span title='2024-02-08 00:00:00 +0000 UTC'>February 8, 2024&lt;/span>&amp;nbsp;·&amp;nbsp;3 min&nbsp;|&nbsp;<a href=https://github.com/alukach/alukach.github.io/edit/main/content/posts/ecs-rds-security-group-script.md rel="noopener noreferrer" target=_blank>Edit</a></div></header><div class=post-content><p>Below is a simple script to allow a user to alter RDS databases security groups to allow access from an ECS Service. Useful when we have an observability tool runing in ECS that wants to add RDS data connections.</p><div class=highlight><div style=color:#4d4d4d;background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#4d4d4d;background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">  1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">  2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">  3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">  4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">  5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">  6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">  7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">  8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">  9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 48
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 49
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 50
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 51
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 52
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 53
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 54
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 55
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 56
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 57
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 58
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 59
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 60
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 61
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 62
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 63
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 64
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 65
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 66
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 67
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 68
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 69
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 70
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 71
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 72
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 73
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 74
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 75
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 76
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 77
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 78
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 79
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 80
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 81
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 82
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 83
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 84
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 85
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 86
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 87
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 88
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 89
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 90
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 91
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 92
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 93
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 94
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 95
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 96
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 97
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 98
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 99
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">100
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">101
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">102
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">103
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">104
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">105
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">106
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">107
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">108
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">109
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">110
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">111
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">112
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">113
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">114
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">115
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">116
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">117
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">118
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">119
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">120
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">121
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">122
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">123
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">124
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">125
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">126
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">127
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">128
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">129
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">130
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">131
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">132
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">133
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">134
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">135
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">136
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">137
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">138
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">139
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">140
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">141
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">142
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">143
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">144
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">145
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">146
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">147
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">148
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">149
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">150
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">151
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">152
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">153
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">154
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">155
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">156
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">157
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">158
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">159
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#4d4d4d;background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-py data-lang=py><span style=display:flex><span><span style=color:#2c5dcd;font-weight:700>from</span> typing <span style=color:#2c5dcd;font-weight:700>import</span> List, Dict
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#2c5dcd;font-weight:700>import</span> boto3
</span></span><span style=display:flex><span><span style=color:#2c5dcd;font-weight:700>from</span> botocore.exceptions <span style=color:#2c5dcd;font-weight:700>import</span> ClientError
</span></span><span style=display:flex><span><span style=color:#2c5dcd;font-weight:700>import</span> inquirer
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#2c5dcd;font-weight:700>def</span> <span style=color:#ff8000;font-weight:700>list_ecs_clusters</span>():
</span></span><span style=display:flex><span>    ecs <span style=color:#2c5dcd>=</span> boto3<span style=color:#2c5dcd>.</span>client(<span style=color:#0c6>&#34;ecs&#34;</span>)
</span></span><span style=display:flex><span>    clusters <span style=color:#2c5dcd>=</span> ecs<span style=color:#2c5dcd>.</span>list_clusters()
</span></span><span style=display:flex><span>    cluster_arns <span style=color:#2c5dcd>=</span> clusters[<span style=color:#0c6>&#34;clusterArns&#34;</span>]
</span></span><span style=display:flex><span>    <span style=color:#2c5dcd;font-weight:700>return</span> cluster_arns
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#2c5dcd;font-weight:700>def</span> <span style=color:#ff8000;font-weight:700>list_ecs_services</span>(cluster) <span style=color:#2c5dcd>-&gt;</span> List[<span style=color:#5918bb;font-weight:700>str</span>]:
</span></span><span style=display:flex><span>    ecs <span style=color:#2c5dcd>=</span> boto3<span style=color:#2c5dcd>.</span>client(<span style=color:#0c6>&#34;ecs&#34;</span>)
</span></span><span style=display:flex><span>    services <span style=color:#2c5dcd>=</span> ecs<span style=color:#2c5dcd>.</span>list_services(cluster<span style=color:#2c5dcd>=</span>cluster)
</span></span><span style=display:flex><span>    <span style=color:#2c5dcd;font-weight:700>return</span> services[<span style=color:#0c6>&#34;serviceArns&#34;</span>]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#2c5dcd;font-weight:700>def</span> <span style=color:#ff8000;font-weight:700>list_rds_instances</span>() <span style=color:#2c5dcd>-&gt;</span> Dict[<span style=color:#5918bb;font-weight:700>str</span>, <span style=color:#5918bb;font-weight:700>str</span>]:
</span></span><span style=display:flex><span>    rds <span style=color:#2c5dcd>=</span> boto3<span style=color:#2c5dcd>.</span>client(<span style=color:#0c6>&#34;rds&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#2c5dcd;font-weight:700>return</span> rds<span style=color:#2c5dcd>.</span>describe_db_instances()[<span style=color:#0c6>&#34;DBInstances&#34;</span>]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#2c5dcd;font-weight:700>def</span> <span style=color:#ff8000;font-weight:700>get_security_group_from_ecs_service</span>(cluster, service_arn) <span style=color:#2c5dcd>-&gt;</span> <span style=color:#5918bb;font-weight:700>str</span>:
</span></span><span style=display:flex><span>    ecs <span style=color:#2c5dcd>=</span> boto3<span style=color:#2c5dcd>.</span>client(<span style=color:#0c6>&#34;ecs&#34;</span>)
</span></span><span style=display:flex><span>    details <span style=color:#2c5dcd>=</span> ecs<span style=color:#2c5dcd>.</span>describe_services(cluster<span style=color:#2c5dcd>=</span>cluster, services<span style=color:#2c5dcd>=</span>[service_arn])
</span></span><span style=display:flex><span>    service <span style=color:#2c5dcd>=</span> details[<span style=color:#0c6>&#34;services&#34;</span>][<span style=color:#5918bb;font-weight:700>0</span>]
</span></span><span style=display:flex><span>    deployment <span style=color:#2c5dcd>=</span> service[<span style=color:#0c6>&#34;deployments&#34;</span>][<span style=color:#5918bb;font-weight:700>0</span>]
</span></span><span style=display:flex><span>    groups <span style=color:#2c5dcd>=</span> deployment[<span style=color:#0c6>&#34;networkConfiguration&#34;</span>][<span style=color:#0c6>&#34;awsvpcConfiguration&#34;</span>][<span style=color:#0c6>&#34;securityGroups&#34;</span>]
</span></span><span style=display:flex><span>    <span style=color:#2c5dcd;font-weight:700>return</span> groups[<span style=color:#5918bb;font-weight:700>0</span>]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#2c5dcd;font-weight:700>def</span> <span style=color:#ff8000;font-weight:700>get_security_group_ids_for_rds_instance</span>(instance_identifier) <span style=color:#2c5dcd>-&gt;</span> List[<span style=color:#5918bb;font-weight:700>str</span>]:
</span></span><span style=display:flex><span>    <span style=color:#0c6>&#34;&#34;&#34;
</span></span></span><span style=display:flex><span><span style=color:#0c6>    Returns the security group IDs for a given RDS instance identifier.
</span></span></span><span style=display:flex><span><span style=color:#0c6>
</span></span></span><span style=display:flex><span><span style=color:#0c6>    :param instance_identifier: The identifier of the RDS instance
</span></span></span><span style=display:flex><span><span style=color:#0c6>    :return: A list of security group IDs associated with the RDS instance
</span></span></span><span style=display:flex><span><span style=color:#0c6>    &#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>    rds <span style=color:#2c5dcd>=</span> boto3<span style=color:#2c5dcd>.</span>client(<span style=color:#0c6>&#34;rds&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#2c5dcd;font-weight:700>try</span>:
</span></span><span style=display:flex><span>        response <span style=color:#2c5dcd>=</span> rds<span style=color:#2c5dcd>.</span>describe_db_instances(DBInstanceIdentifier<span style=color:#2c5dcd>=</span>instance_identifier)
</span></span><span style=display:flex><span>        db_instances <span style=color:#2c5dcd>=</span> response[<span style=color:#0c6>&#34;DBInstances&#34;</span>]
</span></span><span style=display:flex><span>        <span style=color:#2c5dcd;font-weight:700>if</span> db_instances:
</span></span><span style=display:flex><span>            <span style=color:#0080ff;font-style:italic># Assuming each instance has at least one security group associated with it</span>
</span></span><span style=display:flex><span>            security_groups <span style=color:#2c5dcd>=</span> db_instances[<span style=color:#5918bb;font-weight:700>0</span>][<span style=color:#0c6>&#34;VpcSecurityGroups&#34;</span>]
</span></span><span style=display:flex><span>            security_group_ids <span style=color:#2c5dcd>=</span> [sg[<span style=color:#0c6>&#34;VpcSecurityGroupId&#34;</span>] <span style=color:#2c5dcd;font-weight:700>for</span> sg <span style=color:#2c5dcd;font-weight:700>in</span> security_groups]
</span></span><span style=display:flex><span>            <span style=color:#2c5dcd;font-weight:700>return</span> security_group_ids
</span></span><span style=display:flex><span>        <span style=color:#2c5dcd;font-weight:700>else</span>:
</span></span><span style=display:flex><span>            <span style=color:#2c5dcd;font-weight:700>return</span> []
</span></span><span style=display:flex><span>    <span style=color:#2c5dcd;font-weight:700>except</span> <span style=color:#5918bb;font-weight:700>Exception</span> <span style=color:#2c5dcd;font-weight:700>as</span> e:
</span></span><span style=display:flex><span>        <span style=color:#5918bb;font-weight:700>print</span>(
</span></span><span style=display:flex><span>            <span style=color:#0c6>f</span><span style=color:#0c6>&#34;Error fetching security group IDs for RDS instance &#39;</span><span style=color:#0c6>{</span>instance_identifier<span style=color:#0c6>}</span><span style=color:#0c6>&#39;: </span><span style=color:#0c6>{</span>e<span style=color:#0c6>}</span><span style=color:#0c6>&#34;</span>
</span></span><span style=display:flex><span>        )
</span></span><span style=display:flex><span>        <span style=color:#2c5dcd;font-weight:700>return</span> []
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#2c5dcd;font-weight:700>def</span> <span style=color:#ff8000;font-weight:700>modify_security_group_rules</span>(
</span></span><span style=display:flex><span>    security_group_id,
</span></span><span style=display:flex><span>    protocol,
</span></span><span style=display:flex><span>    from_port,
</span></span><span style=display:flex><span>    to_port,
</span></span><span style=display:flex><span>    source_security_group_id: <span style=color:#5918bb;font-weight:700>str</span>,
</span></span><span style=display:flex><span>    description: <span style=color:#5918bb;font-weight:700>str</span>,
</span></span><span style=display:flex><span>    dry_run: <span style=color:#5918bb;font-weight:700>bool</span>,
</span></span><span style=display:flex><span>) <span style=color:#2c5dcd>-&gt;</span> <span style=color:#2c5dcd;font-weight:700>None</span>:
</span></span><span style=display:flex><span>    ec2 <span style=color:#2c5dcd>=</span> boto3<span style=color:#2c5dcd>.</span>client(<span style=color:#0c6>&#34;ec2&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#2c5dcd;font-weight:700>if</span> dry_run:
</span></span><span style=display:flex><span>        <span style=color:#5918bb;font-weight:700>print</span>(
</span></span><span style=display:flex><span>            <span style=color:#0c6>f</span><span style=color:#0c6>&#34;Dry run: Would update Security Group </span><span style=color:#0c6>{</span>security_group_id<span style=color:#0c6>}</span><span style=color:#0c6> &#34;</span>
</span></span><span style=display:flex><span>            <span style=color:#0c6>f</span><span style=color:#0c6>&#34;to allow from </span><span style=color:#0c6>{</span>source_security_group_id<span style=color:#0c6>}</span><span style=color:#0c6>&#34;</span>
</span></span><span style=display:flex><span>        )
</span></span><span style=display:flex><span>        <span style=color:#2c5dcd;font-weight:700>return</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#2c5dcd;font-weight:700>try</span>:
</span></span><span style=display:flex><span>        ec2<span style=color:#2c5dcd>.</span>authorize_security_group_ingress(
</span></span><span style=display:flex><span>            GroupId<span style=color:#2c5dcd>=</span>security_group_id,
</span></span><span style=display:flex><span>            IpPermissions<span style=color:#2c5dcd>=</span>[
</span></span><span style=display:flex><span>                {
</span></span><span style=display:flex><span>                    <span style=color:#0c6>&#34;IpProtocol&#34;</span>: protocol,
</span></span><span style=display:flex><span>                    <span style=color:#0c6>&#34;FromPort&#34;</span>: from_port,
</span></span><span style=display:flex><span>                    <span style=color:#0c6>&#34;ToPort&#34;</span>: to_port,
</span></span><span style=display:flex><span>                    <span style=color:#0c6>&#34;UserIdGroupPairs&#34;</span>: [
</span></span><span style=display:flex><span>                        {
</span></span><span style=display:flex><span>                            <span style=color:#0c6>&#34;GroupId&#34;</span>: source_security_group_id,
</span></span><span style=display:flex><span>                            <span style=color:#0c6>&#34;Description&#34;</span>: description,
</span></span><span style=display:flex><span>                        }
</span></span><span style=display:flex><span>                    ],
</span></span><span style=display:flex><span>                }
</span></span><span style=display:flex><span>            ],
</span></span><span style=display:flex><span>        )
</span></span><span style=display:flex><span>        <span style=color:#5918bb;font-weight:700>print</span>(<span style=color:#0c6>f</span><span style=color:#0c6>&#34;Security Group </span><span style=color:#0c6>{</span>security_group_id<span style=color:#0c6>}</span><span style=color:#0c6> updated successfully.&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#2c5dcd;font-weight:700>except</span> ClientError <span style=color:#2c5dcd;font-weight:700>as</span> e:
</span></span><span style=display:flex><span>        <span style=color:#5918bb;font-weight:700>print</span>(<span style=color:#0c6>f</span><span style=color:#0c6>&#34;Error updating Security Group: </span><span style=color:#0c6>{</span>e<span style=color:#0c6>}</span><span style=color:#0c6>&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#2c5dcd;font-weight:700>if</span> __name__ <span style=color:#2c5dcd>==</span> <span style=color:#0c6>&#34;__main__&#34;</span>:
</span></span><span style=display:flex><span>    dry_run <span style=color:#2c5dcd>=</span> inquirer<span style=color:#2c5dcd>.</span>confirm(
</span></span><span style=display:flex><span>        message<span style=color:#2c5dcd>=</span><span style=color:#0c6>&#34;Dry run (no changes will be made)?&#34;</span>,
</span></span><span style=display:flex><span>        default<span style=color:#2c5dcd>=</span><span style=color:#2c5dcd;font-weight:700>True</span>,
</span></span><span style=display:flex><span>    )
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    ecs_clusters <span style=color:#2c5dcd>=</span> list_ecs_clusters()
</span></span><span style=display:flex><span>    rds_instances <span style=color:#2c5dcd>=</span> list_rds_instances()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#0080ff;font-style:italic># Select ECS Cluster</span>
</span></span><span style=display:flex><span>    resource_questions <span style=color:#2c5dcd>=</span> [
</span></span><span style=display:flex><span>        inquirer<span style=color:#2c5dcd>.</span>List(
</span></span><span style=display:flex><span>            <span style=color:#0c6>&#34;cluster&#34;</span>,
</span></span><span style=display:flex><span>            message<span style=color:#2c5dcd>=</span><span style=color:#0c6>&#34;Select ECS Cluster that contains the service that requires databases access&#34;</span>,
</span></span><span style=display:flex><span>            choices<span style=color:#2c5dcd>=</span>ecs_clusters,
</span></span><span style=display:flex><span>            default<span style=color:#2c5dcd>=</span><span style=color:#2c5dcd;font-weight:700>lambda</span> answers: <span style=color:#5918bb;font-weight:700>next</span>(
</span></span><span style=display:flex><span>                (cluster <span style=color:#2c5dcd;font-weight:700>for</span> cluster <span style=color:#2c5dcd;font-weight:700>in</span> ecs_clusters <span style=color:#2c5dcd;font-weight:700>if</span> <span style=color:#0c6>&#34;grafana&#34;</span> <span style=color:#2c5dcd;font-weight:700>in</span> cluster), <span style=color:#2c5dcd;font-weight:700>None</span>
</span></span><span style=display:flex><span>            ),
</span></span><span style=display:flex><span>        ),
</span></span><span style=display:flex><span>        inquirer<span style=color:#2c5dcd>.</span>List(
</span></span><span style=display:flex><span>            <span style=color:#0c6>&#34;service&#34;</span>,
</span></span><span style=display:flex><span>            message<span style=color:#2c5dcd>=</span><span style=color:#0c6>&#34;Select ECS Service in </span><span style=color:#0c6>{cluster}</span><span style=color:#0c6> that requires database access&#34;</span>,
</span></span><span style=display:flex><span>            choices<span style=color:#2c5dcd>=</span><span style=color:#2c5dcd;font-weight:700>lambda</span> answers: list_ecs_services(answers[<span style=color:#0c6>&#34;cluster&#34;</span>]),
</span></span><span style=display:flex><span>        ),
</span></span><span style=display:flex><span>        inquirer<span style=color:#2c5dcd>.</span>Checkbox(
</span></span><span style=display:flex><span>            <span style=color:#0c6>&#34;rds_instances&#34;</span>,
</span></span><span style=display:flex><span>            message<span style=color:#2c5dcd>=</span><span style=color:#0c6>&#34;Select RDS Instances that will be accessed via </span><span style=color:#0c6>{cluster}</span><span style=color:#0c6>/</span><span style=color:#0c6>{service}</span><span style=color:#0c6>&#34;</span>,
</span></span><span style=display:flex><span>            choices<span style=color:#2c5dcd>=</span>[instance[<span style=color:#0c6>&#34;DBInstanceIdentifier&#34;</span>] <span style=color:#2c5dcd;font-weight:700>for</span> instance <span style=color:#2c5dcd;font-weight:700>in</span> rds_instances],
</span></span><span style=display:flex><span>        ),
</span></span><span style=display:flex><span>        inquirer<span style=color:#2c5dcd>.</span>Text(
</span></span><span style=display:flex><span>            <span style=color:#0c6>&#34;description&#34;</span>,
</span></span><span style=display:flex><span>            message<span style=color:#2c5dcd>=</span><span style=color:#0c6>&#34;Provide a description for the connection&#34;</span>,
</span></span><span style=display:flex><span>            default<span style=color:#2c5dcd>=</span><span style=color:#2c5dcd;font-weight:700>lambda</span> answers: <span style=color:#0c6>f</span><span style=color:#0c6>&#34;Allow connections from ECS service: </span><span style=color:#0c6>{</span>answers[<span style=color:#0c6>&#39;service&#39;</span>]<span style=color:#2c5dcd>.</span>split(<span style=color:#0c6>&#39;:&#39;</span>)[<span style=color:#2c5dcd>-</span><span style=color:#5918bb;font-weight:700>1</span>]<span style=color:#0c6>}</span><span style=color:#0c6>&#34;</span>,
</span></span><span style=display:flex><span>        ),
</span></span><span style=display:flex><span>    ]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    resources <span style=color:#2c5dcd>=</span> inquirer<span style=color:#2c5dcd>.</span>prompt(resource_questions)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#0080ff;font-style:italic># Get Security Group of selected RDS Instances</span>
</span></span><span style=display:flex><span>    rds_security_groups <span style=color:#2c5dcd>=</span> [
</span></span><span style=display:flex><span>        get_security_group_ids_for_rds_instance(rds_instance)[<span style=color:#5918bb;font-weight:700>0</span>]
</span></span><span style=display:flex><span>        <span style=color:#2c5dcd;font-weight:700>for</span> rds_instance <span style=color:#2c5dcd;font-weight:700>in</span> resources[<span style=color:#0c6>&#34;rds_instances&#34;</span>]
</span></span><span style=display:flex><span>    ]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#0080ff;font-style:italic># Get Security Group of selected ECS Service</span>
</span></span><span style=display:flex><span>    ecs_security_group <span style=color:#2c5dcd>=</span> get_security_group_from_ecs_service(
</span></span><span style=display:flex><span>        resources[<span style=color:#0c6>&#34;cluster&#34;</span>], resources[<span style=color:#0c6>&#34;service&#34;</span>]
</span></span><span style=display:flex><span>    )
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#0080ff;font-style:italic># Update RDS Instances&#39; Security Groups to allow inbound connections from ECS Service</span>
</span></span><span style=display:flex><span>    <span style=color:#5918bb;font-weight:700>print</span>(<span style=color:#0c6>f</span><span style=color:#0c6>&#34;</span><span style=color:#0c6>{</span>rds_security_groups<span style=color:#0c6>=}</span><span style=color:#0c6>&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#2c5dcd;font-weight:700>for</span> rds_sg_id <span style=color:#2c5dcd;font-weight:700>in</span> rds_security_groups:
</span></span><span style=display:flex><span>        modify_security_group_rules(
</span></span><span style=display:flex><span>            security_group_id<span style=color:#2c5dcd>=</span>rds_sg_id,
</span></span><span style=display:flex><span>            source_security_group_id<span style=color:#2c5dcd>=</span>ecs_security_group,
</span></span><span style=display:flex><span>            protocol<span style=color:#2c5dcd>=</span><span style=color:#0c6>&#34;tcp&#34;</span>,
</span></span><span style=display:flex><span>            to_port<span style=color:#2c5dcd>=</span><span style=color:#5918bb;font-weight:700>5432</span>,
</span></span><span style=display:flex><span>            from_port<span style=color:#2c5dcd>=</span><span style=color:#5918bb;font-weight:700>5432</span>,
</span></span><span style=display:flex><span>            description<span style=color:#2c5dcd>=</span>resources[<span style=color:#0c6>&#34;description&#34;</span>],
</span></span><span style=display:flex><span>            dry_run<span style=color:#2c5dcd>=</span>dry_run,
</span></span><span style=display:flex><span>        )
</span></span></code></pre></td></tr></table></div></div></div><footer class=post-footer><ul class=post-tags><li><a href=https://alukach.com/tags/ecs/>Ecs</a></li><li><a href=https://alukach.com/tags/rds/>Rds</a></li><li><a href=https://alukach.com/tags/aws/>Aws</a></li></ul></footer></article></main><footer class=footer><span>&copy; 2024 <a href=https://alukach.com/>anthony lukach</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://git.io/hugopapermod rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerText="copy";function s(){t.innerText="copied!",setTimeout(()=>{t.innerText="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>