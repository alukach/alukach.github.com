<!doctype html><html lang=en-us><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><title>Tips for working with a large number of files in S3 | anthony lukach</title><meta name=description content="A collection of notes."><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="all,follow"><meta name=googlebot content="index,follow,snippet,archive"><meta property="og:title" content="Tips for working with a large number of files in S3"><meta property="og:description" content="I would argue that S3 is basically AWS' best service. It&rsquo;s super cheap, it&rsquo;s basically infinitely scalable, and it never goes down (except for when it does). Part of its beauty is its simplicity. You give it a file and a key to identify that file, you can have faith that it will store it without issue. You give it a key, you can have faith that it will return the file represented by that key, assuming there is one."><meta property="og:type" content="article"><meta property="og:url" content="http://alukach.com/posts/tips_for_working_with_a_large_number_of_files_in_s3/"><meta property="article:published_time" content="2020-05-30T00:00:00+00:00"><meta property="article:modified_time" content="2020-05-30T00:00:00+00:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Tips for working with a large number of files in S3"><meta name=twitter:description content="I would argue that S3 is basically AWS' best service. It&rsquo;s super cheap, it&rsquo;s basically infinitely scalable, and it never goes down (except for when it does). Part of its beauty is its simplicity. You give it a file and a key to identify that file, you can have faith that it will store it without issue. You give it a key, you can have faith that it will return the file represented by that key, assuming there is one."><link rel=stylesheet href=http://alukach.com/css/style-white.css><link rel=stylesheet href=http://alukach.com/css/custom.css><!--[if lt IE 9]><script src=https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js></script><script src=https://oss.maxcdn.com/respond/1.4.2/respond.min.js></script><![endif]--><link rel=icon type=image/png href=http://alukach.com/images/favicon.ico><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-16401510-1','auto');ga('send','pageview');}</script></head><body class="max-width mx-auto px3 ltr"><div class="content index py4"><div id=header-post><a id=menu-icon href=#><i class="fas fa-bars fa-lg"></i></a><a id=menu-icon-tablet href=#><i class="fas fa-bars fa-lg"></i></a><a id=top-icon-tablet href=# onclick="$('html, body').animate({scrollTop:0},'fast');" style=display:none><i class="fas fa-chevron-up fa-lg"></i></a><span id=menu><span id=nav><ul><li><a href=/>Home</a></li><li><a href=/posts>Writings</a></li></ul></span><br><span id=actions><ul><li><a class=icon href=http://alukach.com/posts/aws-s3-batch-operation-lambda-boilerplate/><i class="fas fa-chevron-left" aria-hidden=true onmouseover="$('#i-prev').toggle();" onmouseout="$('#i-prev').toggle();"></i></a></li><li><a class=icon href=http://alukach.com/posts/database_uri_from_secret/><i class="fas fa-chevron-right" aria-hidden=true onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i></a></li><li><a class=icon href=# onclick="$('html, body').animate({scrollTop:0},'fast');"><i class="fas fa-chevron-up" aria-hidden=true onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li><li><a class=icon href=#><i class="fas fa-share-alt" aria-hidden=true onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i></a></li></ul><span id=i-prev class=info style=display:none>Previous post</span>
<span id=i-next class=info style=display:none>Next post</span>
<span id=i-top class=info style=display:none>Back to top</span>
<span id=i-share class=info style=display:none>Share post</span></span><br><div id=share style=display:none><ul><li><a class=icon href="http://www.facebook.com/sharer.php?u=http%3a%2f%2falukach.com%2fposts%2ftips_for_working_with_a_large_number_of_files_in_s3%2f"><i class="fab fa-facebook" aria-hidden=true></i></a></li><li><a class=icon href="https://twitter.com/share?url=http%3a%2f%2falukach.com%2fposts%2ftips_for_working_with_a_large_number_of_files_in_s3%2f&text=Tips%20for%20working%20with%20a%20large%20number%20of%20files%20in%20S3"><i class="fab fa-twitter" aria-hidden=true></i></a></li><li><a class=icon href="http://www.linkedin.com/shareArticle?url=http%3a%2f%2falukach.com%2fposts%2ftips_for_working_with_a_large_number_of_files_in_s3%2f&title=Tips%20for%20working%20with%20a%20large%20number%20of%20files%20in%20S3"><i class="fab fa-linkedin" aria-hidden=true></i></a></li><li><a class=icon href="https://pinterest.com/pin/create/bookmarklet/?url=http%3a%2f%2falukach.com%2fposts%2ftips_for_working_with_a_large_number_of_files_in_s3%2f&is_video=false&description=Tips%20for%20working%20with%20a%20large%20number%20of%20files%20in%20S3"><i class="fab fa-pinterest" aria-hidden=true></i></a></li><li><a class=icon href="mailto:?subject=Tips%20for%20working%20with%20a%20large%20number%20of%20files%20in%20S3&body=Check out this article: http%3a%2f%2falukach.com%2fposts%2ftips_for_working_with_a_large_number_of_files_in_s3%2f"><i class="fas fa-envelope" aria-hidden=true></i></a></li><li><a class=icon href="https://getpocket.com/save?url=http%3a%2f%2falukach.com%2fposts%2ftips_for_working_with_a_large_number_of_files_in_s3%2f&title=Tips%20for%20working%20with%20a%20large%20number%20of%20files%20in%20S3"><i class="fab fa-get-pocket" aria-hidden=true></i></a></li><li><a class=icon href="http://reddit.com/submit?url=http%3a%2f%2falukach.com%2fposts%2ftips_for_working_with_a_large_number_of_files_in_s3%2f&title=Tips%20for%20working%20with%20a%20large%20number%20of%20files%20in%20S3"><i class="fab fa-reddit" aria-hidden=true></i></a></li><li><a class=icon href="http://www.stumbleupon.com/submit?url=http%3a%2f%2falukach.com%2fposts%2ftips_for_working_with_a_large_number_of_files_in_s3%2f&title=Tips%20for%20working%20with%20a%20large%20number%20of%20files%20in%20S3"><i class="fab fa-stumbleupon" aria-hidden=true></i></a></li><li><a class=icon href="http://digg.com/submit?url=http%3a%2f%2falukach.com%2fposts%2ftips_for_working_with_a_large_number_of_files_in_s3%2f&title=Tips%20for%20working%20with%20a%20large%20number%20of%20files%20in%20S3"><i class="fab fa-digg" aria-hidden=true></i></a></li><li><a class=icon href="http://www.tumblr.com/share/link?url=http%3a%2f%2falukach.com%2fposts%2ftips_for_working_with_a_large_number_of_files_in_s3%2f&name=Tips%20for%20working%20with%20a%20large%20number%20of%20files%20in%20S3&description=I%20would%20argue%20that%20S3%20is%20basically%20AWS%27%20best%20service.%20It%26rsquo%3bs%20super%20cheap%2c%20it%26rsquo%3bs%20basically%20infinitely%20scalable%2c%20and%20it%20never%20goes%20down%20%28except%20for%20when%20it%20does%29.%20Part%20of%20its%20beauty%20is%20its%20simplicity.%20You%20give%20it%20a%20file%20and%20a%20key%20to%20identify%20that%20file%2c%20you%20can%20have%20faith%20that%20it%20will%20store%20it%20without%20issue.%20You%20give%20it%20a%20key%2c%20you%20can%20have%20faith%20that%20it%20will%20return%20the%20file%20represented%20by%20that%20key%2c%20assuming%20there%20is%20one."><i class="fab fa-tumblr" aria-hidden=true></i></a></li><li><a class=icon href="https://news.ycombinator.com/submitlink?u=http%3a%2f%2falukach.com%2fposts%2ftips_for_working_with_a_large_number_of_files_in_s3%2f&t=Tips%20for%20working%20with%20a%20large%20number%20of%20files%20in%20S3"><i class="fab fa-hacker-news" aria-hidden=true></i></a></li></ul></div><div id=toc><nav id=TableOfContents><ul><li><a href=#listing-files>Listing Files</a></li><li><a href=#querying-files-by-s3-properties>Querying files by S3 Properties</a></li><li><a href=#processing-files>Processing Files</a></li><li><a href=#things-not-discussed-in-this-post>Things not discussed in this post</a></li></ul></nav></div></span></div><article class=post itemscope itemtype=http://schema.org/BlogPosting><header><h1 class=posttitle itemprop="name headline">Tips for working with a large number of files in S3</h1><div class=meta><div class=postdate><time datetime="2020-05-30 00:00:00 +0000 UTC" itemprop=datePublished>2020-05-30</time></div><div class=article-tag><i class="fas fa-tag"></i><a class=tag-link href=/tags/python rel=tag>python</a>
,
<a class=tag-link href=/tags/aws rel=tag>aws</a>
,
<a class=tag-link href=/tags/s3 rel=tag>s3</a></div></div></header><div class=content itemprop=articleBody><p>I would argue that S3 is basically AWS' best service. It&rsquo;s super cheap, it&rsquo;s basically infinitely scalable, and it never goes down (except for <a href=https://www.theregister.co.uk/2017/03/01/aws_s3_outage/>when it does</a>). Part of its beauty is its simplicity. You give it a file and a key to identify that file, you can have faith that it will store it without issue. You give it a key, you can have faith that it will return the file represented by that key, assuming there is one.</p><p>However, when you&rsquo;ve enlisted S3 to manage a large number of files (1M+), it can get complicated to do anything beyond doing simple writes and retrievals. Fortunately, there are a number of helpers available to make it manageable to working with this scale of data. This post aims to capture some common workflows that may be of use when working with huge S3 buckets.</p><h2 id=listing-files>Listing Files</h2><p>The mere act of listing all of the data within a huge S3 bucket is a challenge. S3&rsquo;s <a href=https://docs.aws.amazon.com/cli/latest/reference/s3api/list-objects.html>list-objects API</a> returns a max of 1000 items per request, meaning you&rsquo;ll have to work through thousands of pages of API responses to fully list all items within the bucket. To make this simpler, we can utilize <a href=https://docs.aws.amazon.com/AmazonS3/latest/dev/storage-inventory.html>S3&rsquo;s Inventory</a>.</p><blockquote><p>Amazon S3 inventory provides comma-separated values (CSV), Apache optimized row columnar (ORC) or Apache Parquet (Parquet) output files that list your objects and their corresponding metadata on a daily or weekly basis for an S3 bucket or a shared prefix.</p></blockquote><p>Be aware that it can take up to 48 hours to generate an Inventory Report. From that point forward, reports can be generated on a regular interval.</p><p>An inventory report serves as a great first-step when attempting to do any processing on an entire bucket of files. Often, you don&rsquo;t need to retrieve the inventory report manually from S3. Instead, it can be fed into Athena or S3 Batch Operations as described below.</p><p>However, when you do need to access the data locally, downloading and reading all of the gzipped CSV files that make up an inventory report can be somewhat tedious. The following script was written to help with this process. Its output can be piped to a local CSV file to create a single output or sent to another function for processing.</p><details><summary>Stream S3 Inventory Report Python script</summary><div class=highlight><div style=color:#4d4d4d;background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#4d4d4d;background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">25
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#4d4d4d;background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-py data-lang=py><span style=color:#2c5dcd;font-weight:700>import</span> json
<span style=color:#2c5dcd;font-weight:700>import</span> csv
<span style=color:#2c5dcd;font-weight:700>import</span> gzip

<span style=color:#2c5dcd;font-weight:700>import</span> boto3

s3 <span style=color:#2c5dcd>=</span> boto3<span style=color:#2c5dcd>.</span>resource(<span style=color:#0c6>&#39;s3&#39;</span>)


<span style=color:#2c5dcd;font-weight:700>def</span> <span style=color:#ff8000;font-weight:700>list_keys</span>(bucket, manifest_key):
    manifest <span style=color:#2c5dcd>=</span> json<span style=color:#2c5dcd>.</span>load(s3<span style=color:#2c5dcd>.</span>Object(bucket, manifest_key)<span style=color:#2c5dcd>.</span>get()[<span style=color:#0c6>&#39;Body&#39;</span>])
    <span style=color:#2c5dcd;font-weight:700>for</span> obj <span style=color:#2c5dcd;font-weight:700>in</span> manifest[<span style=color:#0c6>&#39;files&#39;</span>]:
        gzip_obj <span style=color:#2c5dcd>=</span> s3<span style=color:#2c5dcd>.</span>Object(bucket_name<span style=color:#2c5dcd>=</span>bucket, key<span style=color:#2c5dcd>=</span>obj[<span style=color:#0c6>&#39;key&#39;</span>])
        <span style=color:#5918bb;font-weight:700>buffer</span> <span style=color:#2c5dcd>=</span> gzip<span style=color:#2c5dcd>.</span>open(gzip_obj<span style=color:#2c5dcd>.</span>get()[<span style=color:#0c6>&#34;Body&#34;</span>], mode<span style=color:#2c5dcd>=</span><span style=color:#0c6>&#39;rt&#39;</span>)
        reader <span style=color:#2c5dcd>=</span> csv<span style=color:#2c5dcd>.</span>reader(<span style=color:#5918bb;font-weight:700>buffer</span>)
        <span style=color:#2c5dcd;font-weight:700>for</span> row <span style=color:#2c5dcd;font-weight:700>in</span> reader:
            <span style=color:#2c5dcd;font-weight:700>yield</span> row


<span style=color:#2c5dcd;font-weight:700>if</span> __name__ <span style=color:#2c5dcd>==</span> <span style=color:#0c6>&#39;__main__&#39;</span>:
    bucket <span style=color:#2c5dcd>=</span> <span style=color:#0c6>&#39;s3-inventory-output-bucket&#39;</span>
    manifest_key <span style=color:#2c5dcd>=</span> <span style=color:#0c6>&#39;path/to/my/inventory/2019-12-15T00-00Z/manifest.json&#39;</span>

    <span style=color:#2c5dcd;font-weight:700>for</span> bucket, key, <span style=color:#2c5dcd>*</span>rest <span style=color:#2c5dcd;font-weight:700>in</span> list_keys(bucket, manifest_key):
        <span style=color:#2c5dcd;font-weight:700>print</span>(bucket, key, <span style=color:#2c5dcd>*</span>rest)
</code></pre></td></tr></table></div></div></details><h2 id=querying-files-by-s3-properties>Querying files by S3 Properties</h2><p>Sometimes you may need a subset of the files within S3, based some metadata property of the object (e.g. the key&rsquo;s extension). While you can use the S3 list-objects API to list files beginning with a particular prefix, you can not filter by suffix. To get around this limitation, we can utilize AWS Athena to query over an S3 Inventory report.</p><details><summary>1. Create a table</summary><p><em>This example assumes that you chose <code>CSV</code> as the S3 Inventory Output Format. For information on other formats, review <a href=https://docs.aws.amazon.com/athena/latest/ug/supported-format.html>the docs.</a></em></p><div class=highlight><div style=color:#4d4d4d;background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#4d4d4d;background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">25
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#4d4d4d;background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-sql data-lang=sql><span style=color:#2c5dcd;font-weight:700>CREATE</span> <span style=color:#2c5dcd;font-weight:700>EXTERNAL</span> <span style=color:#2c5dcd;font-weight:700>TABLE</span> your_table_name(
  <span style=color:#2c5dcd>`</span>bucket<span style=color:#2c5dcd>`</span> string,
  <span style=color:#2c5dcd;font-weight:700>key</span> string,
  version_id string,
  is_latest <span style=color:#5918bb;font-weight:700>boolean</span>,
  is_delete_marker <span style=color:#5918bb;font-weight:700>boolean</span>,
  <span style=color:#2c5dcd;font-weight:700>size</span> <span style=color:#5918bb;font-weight:700>bigint</span>,
  last_modified_date <span style=color:#2c5dcd;font-weight:700>timestamp</span>,
  e_tag string,
  storage_class string,
  is_multipart_uploaded <span style=color:#5918bb;font-weight:700>boolean</span>,
  replication_status string,
  encryption_status string,
  object_lock_retain_until_date <span style=color:#2c5dcd;font-weight:700>timestamp</span>,
  object_lock_mode string,
  object_lock_legal_hold_status string
  )
  PARTITIONED <span style=color:#2c5dcd;font-weight:700>BY</span> (dt string)
  <span style=color:#2c5dcd;font-weight:700>ROW</span> FORMAT DELIMITED
    FIELDS TERMINATED <span style=color:#2c5dcd;font-weight:700>BY</span> <span style=color:#0c6>&#39;,&#39;</span>
    ESCAPED <span style=color:#2c5dcd;font-weight:700>BY</span> <span style=color:#0c6>&#39;\\&#39;</span>
    LINES TERMINATED <span style=color:#2c5dcd;font-weight:700>BY</span> <span style=color:#0c6>&#39;\n&#39;</span>
  STORED <span style=color:#2c5dcd;font-weight:700>AS</span> INPUTFORMAT <span style=color:#0c6>&#39;org.apache.hadoop.hive.ql.io.SymlinkTextInputFormat&#39;</span>
  OUTPUTFORMAT  <span style=color:#0c6>&#39;org.apache.hadoop.hive.ql.io.IgnoreKeyTextOutputFormat&#39;</span>
  <span style=color:#2c5dcd;font-weight:700>LOCATION</span> <span style=color:#0c6>&#39;s3://destination-prefix/source-bucket/YOUR_CONFIG_ID/hive/&#39;</span>;
</code></pre></td></tr></table></div></div></details><details><summary>2. Add inventory reports partitions</summary><div class=highlight><div style=color:#4d4d4d;background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#4d4d4d;background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#4d4d4d;background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-sql data-lang=sql>MSCK REPAIR <span style=color:#2c5dcd;font-weight:700>TABLE</span> your_table_name;
</code></pre></td></tr></table></div></div></details><details><summary>3. Query for S3 keys by their filename, size, storage class, etc</summary><div class=highlight><div style=color:#4d4d4d;background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#4d4d4d;background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#4d4d4d;background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-sql data-lang=sql><span style=color:#2c5dcd;font-weight:700>SELECT</span> storage_class, <span style=color:#2c5dcd;font-weight:700>count</span>(<span style=color:#2c5dcd>*</span>) <span style=color:#2c5dcd;font-weight:700>as</span> <span style=color:#2c5dcd;font-weight:700>count</span>
<span style=color:#2c5dcd;font-weight:700>FROM</span> your_table_name
<span style=color:#2c5dcd;font-weight:700>WHERE</span> dt <span style=color:#2c5dcd>=</span> <span style=color:#0c6>&#39;2019-12-22-00-00&#39;</span>
<span style=color:#2c5dcd;font-weight:700>GROUP</span> <span style=color:#2c5dcd;font-weight:700>BY</span> storage_class
</code></pre></td></tr></table></div></div></details><p>More information about querying Storage Inventory files with Athena can be <a href=https://docs.aws.amazon.com/AmazonS3/latest/dev/storage-inventory.html#storage-inventory-athena-query>found here</a>.</p><h2 id=processing-files>Processing Files</h2><p>Situations may arise where you need to run all (or a large number) of the files within an S3 bucket through some operation. <a href=https://docs.aws.amazon.com/AmazonS3/latest/user-guide/batch-ops.html>S3 Batch Operations</a> (not to be confused with <a href=https://aws.amazon.com/batch/>AWS Batch</a>) is built to do the following:</p><blockquote><p>copy objects, set object tags or access control lists (ACLs), initiate object restores from Amazon S3 Glacier, or invoke an AWS Lambda function to perform custom actions using your objects.</p></blockquote><p>With that last feature, invoking an AWS Lambda function, we can utilize Batch Operations to process a massive number of files without dealing without any of the complexity associated with data-processing infrastructure. Instead, we provide the Batch Operations with a CSV or S3 Inventory Manifest file and a Lambda function to run over each file.</p><p>To work with S3 Batch Operations, the lambda function must return a particular response object to describe if the process succeeded, failed, or failed but should be retried.</p><details><summary>S3 Batch Operation Boilerplate Python script</summary><div class=highlight><div style=color:#4d4d4d;background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#4d4d4d;background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">25
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">26
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">27
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">28
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">29
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">30
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">31
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">32
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">33
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">34
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">35
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">36
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">37
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">38
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">39
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">40
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">41
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">42
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">43
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">44
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">45
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">46
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">47
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">48
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">49
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">50
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">51
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">52
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">53
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">54
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">55
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">56
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">57
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">58
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">59
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">60
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">61
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">62
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">63
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">64
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">65
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">66
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">67
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">68
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">69
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">70
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">71
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">72
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">73
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">74
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#4d4d4d;background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-py data-lang=py><span style=color:#2c5dcd;font-weight:700>import</span> urllib

<span style=color:#2c5dcd;font-weight:700>import</span> boto3
<span style=color:#2c5dcd;font-weight:700>from</span> botocore.exceptions <span style=color:#2c5dcd;font-weight:700>import</span> ClientError

s3 <span style=color:#2c5dcd>=</span> boto3<span style=color:#2c5dcd>.</span>resource(<span style=color:#0c6>&#34;s3&#34;</span>)


TMP_FAILURE <span style=color:#2c5dcd>=</span> <span style=color:#0c6>&#34;TemporaryFailure&#34;</span>
FAILURE <span style=color:#2c5dcd>=</span> <span style=color:#0c6>&#34;PermanentFailure&#34;</span>
SUCCESS <span style=color:#2c5dcd>=</span> <span style=color:#0c6>&#34;Succeeded&#34;</span>


<span style=color:#2c5dcd;font-weight:700>def</span> <span style=color:#ff8000;font-weight:700>process_object</span>(src_object):
    <span style=color:#2c5dcd;font-weight:700>return</span> <span style=color:#0c6>&#34;TODO: Populate with processing task...&#34;</span>


<span style=color:#2c5dcd;font-weight:700>def</span> <span style=color:#ff8000;font-weight:700>get_task_id</span>(event):
    <span style=color:#2c5dcd;font-weight:700>return</span> event[<span style=color:#0c6>&#34;tasks&#34;</span>][<span style=color:#5918bb;font-weight:700>0</span>][<span style=color:#0c6>&#34;taskId&#34;</span>]


<span style=color:#2c5dcd;font-weight:700>def</span> <span style=color:#ff8000;font-weight:700>parse_job_parameters</span>(event):
    <span style=color:#0080ff;font-style:italic># Parse job parameters from Amazon S3 batch operations</span>
    <span style=color:#0080ff;font-style:italic># jobId = event[&#34;job&#34;][&#34;id&#34;]</span>
    invocationId <span style=color:#2c5dcd>=</span> event[<span style=color:#0c6>&#34;invocationId&#34;</span>]
    invocationSchemaVersion <span style=color:#2c5dcd>=</span> event[<span style=color:#0c6>&#34;invocationSchemaVersion&#34;</span>]
    <span style=color:#2c5dcd;font-weight:700>return</span> <span style=color:#5918bb;font-weight:700>dict</span>(
        invocationId<span style=color:#2c5dcd>=</span>invocationId, invocationSchemaVersion<span style=color:#2c5dcd>=</span>invocationSchemaVersion
    )


<span style=color:#2c5dcd;font-weight:700>def</span> <span style=color:#ff8000;font-weight:700>get_s3_object</span>(event):
    <span style=color:#0080ff;font-style:italic># Parse Amazon S3 Key, Key Version, and Bucket ARN</span>
    s3Key <span style=color:#2c5dcd>=</span> urllib<span style=color:#2c5dcd>.</span>parse<span style=color:#2c5dcd>.</span>unquote(event[<span style=color:#0c6>&#34;tasks&#34;</span>][<span style=color:#5918bb;font-weight:700>0</span>][<span style=color:#0c6>&#34;s3Key&#34;</span>])
    s3VersionId <span style=color:#2c5dcd>=</span> event[<span style=color:#0c6>&#34;tasks&#34;</span>][<span style=color:#5918bb;font-weight:700>0</span>][<span style=color:#0c6>&#34;s3VersionId&#34;</span>]  <span style=color:#0080ff;font-style:italic># Unused</span>
    s3BucketArn <span style=color:#2c5dcd>=</span> event[<span style=color:#0c6>&#34;tasks&#34;</span>][<span style=color:#5918bb;font-weight:700>0</span>][<span style=color:#0c6>&#34;s3BucketArn&#34;</span>]
    s3Bucket <span style=color:#2c5dcd>=</span> s3BucketArn<span style=color:#2c5dcd>.</span>split(<span style=color:#0c6>&#34;:::&#34;</span>)[<span style=color:#2c5dcd>-</span><span style=color:#5918bb;font-weight:700>1</span>]
    <span style=color:#2c5dcd;font-weight:700>return</span> s3<span style=color:#2c5dcd>.</span>Object(s3Bucket, s3Key)


<span style=color:#2c5dcd;font-weight:700>def</span> <span style=color:#ff8000;font-weight:700>build_result</span>(status: <span style=color:#5918bb;font-weight:700>str</span>, msg: <span style=color:#5918bb;font-weight:700>str</span>):
    <span style=color:#2c5dcd;font-weight:700>return</span> <span style=color:#5918bb;font-weight:700>dict</span>(resultCode<span style=color:#2c5dcd>=</span>status, resultString<span style=color:#2c5dcd>=</span>msg)


<span style=color:#2c5dcd;font-weight:700>def</span> <span style=color:#ff8000;font-weight:700>handler</span>(event, context):
    task_id <span style=color:#2c5dcd>=</span> get_task_id(event)
    job_params <span style=color:#2c5dcd>=</span> parse_job_parameters(event)
    s3_object <span style=color:#2c5dcd>=</span> get_s3_object(event)

    <span style=color:#2c5dcd;font-weight:700>try</span>:
        output <span style=color:#2c5dcd>=</span> process_object(s3_object)
        <span style=color:#0080ff;font-style:italic># Mark as succeeded</span>
        result <span style=color:#2c5dcd>=</span> build_result(SUCCESS, output)
    <span style=color:#2c5dcd;font-weight:700>except</span> ClientError <span style=color:#2c5dcd;font-weight:700>as</span> e:
        <span style=color:#0080ff;font-style:italic># If request timed out, mark as a temp failure</span>
        <span style=color:#0080ff;font-style:italic># and Amazon S3 batch operations will make the task for retry. If</span>
        <span style=color:#0080ff;font-style:italic># any other exceptions are received, mark as permanent failure.</span>
        errorCode <span style=color:#2c5dcd>=</span> e<span style=color:#2c5dcd>.</span>response[<span style=color:#0c6>&#34;Error&#34;</span>][<span style=color:#0c6>&#34;Code&#34;</span>]
        errorMessage <span style=color:#2c5dcd>=</span> e<span style=color:#2c5dcd>.</span>response[<span style=color:#0c6>&#34;Error&#34;</span>][<span style=color:#0c6>&#34;Message&#34;</span>]
        <span style=color:#2c5dcd;font-weight:700>if</span> errorCode <span style=color:#2c5dcd>==</span> <span style=color:#0c6>&#34;RequestTimeout&#34;</span>:
            result <span style=color:#2c5dcd>=</span> build_result(
                TMP_FAILURE, <span style=color:#0c6>&#34;Retry request to Amazon S3 due to timeout.&#34;</span>
            )
        <span style=color:#2c5dcd;font-weight:700>else</span>:
            result <span style=color:#2c5dcd>=</span> build_result(FAILURE, f<span style=color:#0c6>&#34;{errorCode}: {errorMessage}&#34;</span>)
    <span style=color:#2c5dcd;font-weight:700>except</span> <span style=color:#5918bb;font-weight:700>Exception</span> <span style=color:#2c5dcd;font-weight:700>as</span> e:
        <span style=color:#0080ff;font-style:italic># Catch all exceptions to permanently fail the task</span>
        result <span style=color:#2c5dcd>=</span> build_result(FAILURE, f<span style=color:#0c6>&#34;Exception: {e}&#34;</span>)

    <span style=color:#2c5dcd;font-weight:700>return</span> {
        <span style=color:#2c5dcd>**</span>job_params,
        <span style=color:#0c6>&#34;treatMissingKeysAs&#34;</span>: <span style=color:#0c6>&#34;PermanentFailure&#34;</span>,
        <span style=color:#0c6>&#34;results&#34;</span>: [{<span style=color:#2c5dcd>**</span>result, <span style=color:#0c6>&#34;taskId&#34;</span>: task_id}],
    }
</code></pre></td></tr></table></div></div></details><p>S3 Batch Operations will then run every key through this Lambda handler, retry temporary failures, and log its results in result files. The result files are conveniently grouped by success/failure status and linked to from a Manifest Result File.</p><details><summary>Example Manifest Result File</summary><div class=highlight><div style=color:#4d4d4d;background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#4d4d4d;background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#4d4d4d;background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-json data-lang=json>{
    <span style=color:#2c5dcd;font-weight:700>&#34;Format&#34;</span>: <span style=color:#0c6>&#34;Report_CSV_20180820&#34;</span>,
    <span style=color:#2c5dcd;font-weight:700>&#34;ReportCreationDate&#34;</span>: <span style=color:#0c6>&#34;2019-04-05T17:48:39.725Z&#34;</span>,
    <span style=color:#2c5dcd;font-weight:700>&#34;Results&#34;</span>: [
        {
            <span style=color:#2c5dcd;font-weight:700>&#34;TaskExecutionStatus&#34;</span>: <span style=color:#0c6>&#34;succeeded&#34;</span>,
            <span style=color:#2c5dcd;font-weight:700>&#34;Bucket&#34;</span>: <span style=color:#0c6>&#34;my-job-reports&#34;</span>,
            <span style=color:#2c5dcd;font-weight:700>&#34;MD5Checksum&#34;</span>: <span style=color:#0c6>&#34;83b1c4cbe93fc893f54053697e10fd6e&#34;</span>,
            <span style=color:#2c5dcd;font-weight:700>&#34;Key&#34;</span>: <span style=color:#0c6>&#34;job-f8fb9d89-a3aa-461d-bddc-ea6a1b131955/results/6217b0fab0de85c408b4be96aeaca9b195a7daa5.csv&#34;</span>
        },
        {
            <span style=color:#2c5dcd;font-weight:700>&#34;TaskExecutionStatus&#34;</span>: <span style=color:#0c6>&#34;failed&#34;</span>,
            <span style=color:#2c5dcd;font-weight:700>&#34;Bucket&#34;</span>: <span style=color:#0c6>&#34;my-job-reports&#34;</span>,
            <span style=color:#2c5dcd;font-weight:700>&#34;MD5Checksum&#34;</span>: <span style=color:#0c6>&#34;22ee037f3515975f7719699e5c416eaa&#34;</span>,
            <span style=color:#2c5dcd;font-weight:700>&#34;Key&#34;</span>: <span style=color:#0c6>&#34;job-f8fb9d89-a3aa-461d-bddc-ea6a1b131955/results/b2ddad417e94331e9f37b44f1faf8c7ed5873f2e.csv&#34;</span>
        }
    ],
    <span style=color:#2c5dcd;font-weight:700>&#34;ReportSchema&#34;</span>: <span style=color:#0c6>&#34;Bucket, Key, VersionId, TaskStatus, ErrorCode, HTTPStatusCode, ResultMessage&#34;</span>
}
</code></pre></td></tr></table></div></div></details><p>More information about the Complete Report format can be <a href=https://docs.aws.amazon.com/AmazonS3/latest/dev/batch-ops-examples-reports.html>found here</a>.</p><hr><p>At time of writing, S3 Batch Operations cost $0.25 / job + $1 / million S3 objects processed.</p><p>Price to process 5 million thumbnails in 2hrs:</p><ul><li>S3 Batch Operations: $0.25 + (5 * $1) = $5.25</li><li>Lambda: 128MB * 2000 ms * 5,000,000 = $21.83</li><li>S3 Get Requests: 5,000,000 / 1000 * $0.0004 = $2</li><li>S3 Put Requests: 5,000,000 / 1000 * $0.005 = $25</li><li>TOTAL: $54.08</li></ul><h2 id=things-not-discussed-in-this-post>Things not discussed in this post</h2><p>If you are looking for more techniques on querying data stored in S3, consider the following:</p><ul><li><a href=https://aws.amazon.com/blogs/big-data/analyzing-data-in-s3-using-amazon-athena/>Using Athena to query the contents of your files stored in S3</a></li><li><a href=https://aws.amazon.com/blogs/aws/s3-glacier-select/>Using S3 Select to select a subset of a single (very large) file stored in S3</a></li></ul></div></article><div id=footer-post-container><div id=footer-post><div id=nav-footer style=display:none><ul><li><a href=/>Home</a></li><li><a href=/posts>Writings</a></li></ul></div><div id=toc-footer style=display:none><nav id=TableOfContents><ul><li><a href=#listing-files>Listing Files</a></li><li><a href=#querying-files-by-s3-properties>Querying files by S3 Properties</a></li><li><a href=#processing-files>Processing Files</a></li><li><a href=#things-not-discussed-in-this-post>Things not discussed in this post</a></li></ul></nav></div><div id=share-footer style=display:none><ul><li><a class=icon href="http://www.facebook.com/sharer.php?u=http%3a%2f%2falukach.com%2fposts%2ftips_for_working_with_a_large_number_of_files_in_s3%2f"><i class="fab fa-facebook fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="https://twitter.com/share?url=http%3a%2f%2falukach.com%2fposts%2ftips_for_working_with_a_large_number_of_files_in_s3%2f&text=Tips%20for%20working%20with%20a%20large%20number%20of%20files%20in%20S3"><i class="fab fa-twitter fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="http://www.linkedin.com/shareArticle?url=http%3a%2f%2falukach.com%2fposts%2ftips_for_working_with_a_large_number_of_files_in_s3%2f&title=Tips%20for%20working%20with%20a%20large%20number%20of%20files%20in%20S3"><i class="fab fa-linkedin fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="https://pinterest.com/pin/create/bookmarklet/?url=http%3a%2f%2falukach.com%2fposts%2ftips_for_working_with_a_large_number_of_files_in_s3%2f&is_video=false&description=Tips%20for%20working%20with%20a%20large%20number%20of%20files%20in%20S3"><i class="fab fa-pinterest fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="mailto:?subject=Tips%20for%20working%20with%20a%20large%20number%20of%20files%20in%20S3&body=Check out this article: http%3a%2f%2falukach.com%2fposts%2ftips_for_working_with_a_large_number_of_files_in_s3%2f"><i class="fas fa-envelope fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="https://getpocket.com/save?url=http%3a%2f%2falukach.com%2fposts%2ftips_for_working_with_a_large_number_of_files_in_s3%2f&title=Tips%20for%20working%20with%20a%20large%20number%20of%20files%20in%20S3"><i class="fab fa-get-pocket fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="http://reddit.com/submit?url=http%3a%2f%2falukach.com%2fposts%2ftips_for_working_with_a_large_number_of_files_in_s3%2f&title=Tips%20for%20working%20with%20a%20large%20number%20of%20files%20in%20S3"><i class="fab fa-reddit fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="http://www.stumbleupon.com/submit?url=http%3a%2f%2falukach.com%2fposts%2ftips_for_working_with_a_large_number_of_files_in_s3%2f&title=Tips%20for%20working%20with%20a%20large%20number%20of%20files%20in%20S3"><i class="fab fa-stumbleupon fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="http://digg.com/submit?url=http%3a%2f%2falukach.com%2fposts%2ftips_for_working_with_a_large_number_of_files_in_s3%2f&title=Tips%20for%20working%20with%20a%20large%20number%20of%20files%20in%20S3"><i class="fab fa-digg fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="http://www.tumblr.com/share/link?url=http%3a%2f%2falukach.com%2fposts%2ftips_for_working_with_a_large_number_of_files_in_s3%2f&name=Tips%20for%20working%20with%20a%20large%20number%20of%20files%20in%20S3&description=I%20would%20argue%20that%20S3%20is%20basically%20AWS%27%20best%20service.%20It%26rsquo%3bs%20super%20cheap%2c%20it%26rsquo%3bs%20basically%20infinitely%20scalable%2c%20and%20it%20never%20goes%20down%20%28except%20for%20when%20it%20does%29.%20Part%20of%20its%20beauty%20is%20its%20simplicity.%20You%20give%20it%20a%20file%20and%20a%20key%20to%20identify%20that%20file%2c%20you%20can%20have%20faith%20that%20it%20will%20store%20it%20without%20issue.%20You%20give%20it%20a%20key%2c%20you%20can%20have%20faith%20that%20it%20will%20return%20the%20file%20represented%20by%20that%20key%2c%20assuming%20there%20is%20one."><i class="fab fa-tumblr fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="https://news.ycombinator.com/submitlink?u=http%3a%2f%2falukach.com%2fposts%2ftips_for_working_with_a_large_number_of_files_in_s3%2f&t=Tips%20for%20working%20with%20a%20large%20number%20of%20files%20in%20S3"><i class="fab fa-hacker-news fa-lg" aria-hidden=true></i></a></li></ul></div><div id=actions-footer><a id=menu class=icon href=# onclick="$('#nav-footer').toggle();return false;"><i class="fas fa-bars fa-lg" aria-hidden=true></i>Menu</a>
<a id=toc class=icon href=# onclick="$('#toc-footer').toggle();return false;"><i class="fas fa-list fa-lg" aria-hidden=true></i>TOC</a>
<a id=share class=icon href=# onclick="$('#share-footer').toggle();return false;"><i class="fas fa-share-alt fa-lg" aria-hidden=true></i>share</a>
<a id=top style=display:none class=icon href=# onclick="$('html, body').animate({scrollTop:0},'fast');"><i class="fas fa-chevron-up fa-lg" aria-hidden=true></i>Top</a></div></div></div><footer id=footer><div class=footer-left>Copyright &copy; 2021 Anthony Lukach</div><div class=footer-right><nav><ul><li><a href=/>Home</a></li><li><a href=/posts>Writings</a></li></ul></nav></div></footer></div></body><link rel=stylesheet href=/lib/font-awesome/css/all.min.css><script src=/lib/jquery/jquery.min.js></script><script src=/js/main.js></script></html>